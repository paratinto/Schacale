' Gambas class file
moleculesDB AS NEW Object[]

FUNCTION getmolcompDB(seekid AS Integer) AS String[]
  DIM rmolcomp AS Result
  DIM expstrl AS NEW String[] 
  
  rmolcomp = Global.dbcon.Find("molcomp", "id = &1", seekid)
  IF rmolcomp.Length <> 0 THEN 
    FOR EACH rmolcomp
      expstrl.Add(rmolcomp!symbol)
      expstrl.Add(rmolcomp!count)
    NEXT
    RETURN expstrl
  ENDIF 
  
  
END

FUNCTION getmolHazardDB(seekid AS Integer) AS String[]
  DIM rmolhaz AS Result
  DIM expstrl AS NEW String[] 
  
  rmolhaz = Global.dbcon.Find("molhazard", "id = &1", seekid)
  FOR EACH rmolhaz
    expstrl.Add(rmolhaz!hazard)
  NEXT
  
END

PUBLIC SUB loadMoleculesDB()
  DIM resmol AS Result
  DIM nmolec AS NEW Molecule
  DIM i AS Integer
  
  resmol = Global.dbcon.Find("molecules")
  FOR EACH resmol
    nmolec = NEW Molecule
    nmolec.putID(resmol!id)
    nmolec.putName(resmol!name)
    nmolec.putMolcomp(getmolcompDB(resmol!id))
    nmolec.putWeight(resmol!weight)
    nmolec.putDescription(resmol!description)
    nmolec.putGroup(resmol!group)
    nmolec.putHazard(getmolHazardDB(resmol!id))
    nmolec.putCreator(resmol!creator)
    nmolec.putCreator(resmol!creator)
    moleculesDB.Add(nmolec)
  NEXT 
  
  FOR i = 0 TO moleculesDB.Length - 1
    PRINT moleculesDB[i].getName(), moleculesDB[i].getFormula(), moleculesDB[i].getweight()
  NEXT

END


PUBLIC SUB drawMoleculesTV(tview AS TreeView)
  DIM i AS Integer
  FOR i = moleculesDB.Length - 1 TO 0 STEP -1 
    IF moleculesDB[i].getdeleted() = "" 
      tview.Add("Molecules-" & moleculesDB[i].getID(), moleculesDB[i].getname(), Picture["./pic/icons/molecules.png"], "Molecules")
    ENDIF 
  NEXT 
  
  CATCH 
END

PUBLIC SUB putMolecule(item AS Molecule)
  item.createItemDB()
  moleculesDB.Add(item)
END


PUBLIC FUNCTION getMolecule(i AS Integer) AS Molecule
  
  RETURN moleculesDB[i]
  
END
